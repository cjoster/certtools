# ASN.1

Underthe hood of most all of these file formats is what's called ASN.1.
Getting into the details of ASN.1 is beyond the scope of this workshop, but it's
mentioned for completeness and to introduce OpenSSL's `asn1parse` subcommand.
It's a handy command that you can run a blob of binary data through and maybe it'll
tell you what it is you're dealing with.

ASN.1 is a mechanism by which data structures can be formally defined. The whole point
is that then tooling in any language can be used to construct the data structures
that your code needs to work with.

This is the ASN.1 definition of an RSA private key:

```
RSAPrivateKey ::= SEQUENCE {
    version           Version,
    modulus           INTEGER,  -- n
    publicExponent    INTEGER,  -- e
    privateExponent   INTEGER,  -- d
    prime1            INTEGER,  -- p
    prime2            INTEGER,  -- q
    exponent1         INTEGER,  -- d mod (p-1)
    exponent2         INTEGER,  -- d mod (q-1)
    coefficient       INTEGER,  -- (inverse of q) mod p
    otherPrimeInfos   OtherPrimeInfos OPTIONAL
}

Version ::= INTEGER { two-prime(0), multi(1) }
    (CONSTRAINED BY {
        -- version must be multi if otherPrimeInfos present --
    })

OtherPrimeInfos ::= SEQUENCE SIZE(1..MAX) OF OtherPrimeInfo

OtherPrimeInfo ::= SEQUENCE {
    prime             INTEGER,  -- ri
    exponent          INTEGER,  -- di
    coefficient       INTEGER   -- ti
}
```

If you run the command `openssl genrsa 2048 | openssl asn1parse`, you'll get the following output:

```
    0:d=0  hl=4 l=1188 cons: SEQUENCE          
    4:d=1  hl=2 l=   1 prim:  INTEGER           :00             # Version 0 (two-prime)
    7:d=1  hl=4 l= 257 prim:  INTEGER           :BB6C1974B2...  # modulus
  268:d=1  hl=2 l=   3 prim:  INTEGER           :010001         # public exponent
  273:d=1  hl=4 l= 256 prim:  INTEGER           :160F5A0B05...  # private exponent
  533:d=1  hl=3 l= 129 prim:  INTEGER           :F8423D15BC...
  665:d=1  hl=3 l= 129 prim:  INTEGER           :C144398C96...
  797:d=1  hl=3 l= 129 prim:  INTEGER           :89C3B84227...
  929:d=1  hl=3 l= 128 prim:  INTEGER           :05FD46474C...
 1060:d=1  hl=3 l= 129 prim:  INTEGER           :CEEC0800A8...
```

Incidentally, if you're running a new enough versino of OpenSSL that outputs PKCS#8 private keys,
the ASN.1 will look like this:

```
    0:d=0  hl=4 l=1212 cons: SEQUENCE          
    4:d=1  hl=2 l=   1 prim: INTEGER           :00
    7:d=1  hl=2 l=  13 cons: SEQUENCE          
    9:d=2  hl=2 l=   9 prim: OBJECT            :rsaEncryption # RSA OID
   20:d=2  hl=2 l=   0 prim: NULL                         
   22:d=1  hl=4 l=1190 prim: OCTET STRING      [HEX DUMP]:308204A2020100028201010091F30417B4DC5AFEAEBD246FA6CC576B2916FB183E23F2508102AB5EBABBBE450C17A1EA5AF1073F906DF049EE56923092D17EE4D2EE74F048C889BA59B308E962409FCDDB3A61506D03E1B5C8CCA7552DFB4BFCC31E67C8DF8FF580FF44C5C8EDCC35CFFD24C2FDF379497E9796EADA882CB0F329D735364C9B237B223272AE1A24E0F3107015CB9142BFD7B140EB0F5BD7D68B18CC0EA902FEDD17868D550C0A0B12B5771D85CFAE2113E1635B9D04AF0385D5B8F39D47F3142387099427E3836BB9B310FD1FD36E0C5592281604B66D2B8A9B42F2708065F32580927ACE6374D823FE7FB9FA8E1C50307F740A004AA72585B35E7F6EE7A6C9E1FEC67BE92D0203010001028201001D15DD806DF2260E303B9059D1D7522A90673C8601C83F1F8CFE3FB1A2AC0C888D16DE952A277386D6DD19F059D795CDA94CA7A9A9618D1B5F9DDB58B04C8E1F988D816B505FAB8A1017A0710E41BEAD2A7B3492FC3D8078571944D73EC7F15490134CBC14DA3123D3D41D71E57AD575D4827787161505CD3AEA05E1A1988522E0F00EB9A6675C7861E066F5D519728ED2E2C2AC53B44469D6D941219CED23E05D2FCF32E861EC3911D0AE213F03F2F26E09E277E5D02D00F6DF93A80A45E1D99FB51A5A2FD807BFCF07BCD01638FD6BFB77743CFDAF4D0850479D5CBDFFA20F9C73EFA854EE7863993D821C5B5E197952BA7BAFE8C0962A8BDC89FEE01A9AE102818100CDD584B18A8938A0D1066150E13DBC528F16D1A482653E2F60DA4F1AD3901992A12F078D4C4EF591C1C770B434BC74E9418DD0803A1F6125FB8EC6BDF455FB33F93EE2CBDEF8D8D903E4801A2C4166B4D362A01C3825807CB73882A226D94EBFE39E1F7942844B302B764DE6161751222634C045AAAB21873DD9C2DFA0222BDD02818100B585247F207244F331D40E325EB16C60AA7FDAAB214884C108F55D8BAD9D103E7545FFDF49ED4BBEFC61022CB2F46207DDB0806CD33352C76C0C7158402E3A062CE8A2E54F50EA6A4ACD815D262D5BB9C8D6A700410A73891255584517F9D1E660986C93CF8E28760C314A10EA18BBA7CA06E70965240D060C61458A9EE0C5910281803C8599BCB26562B7367ECFC27E582EB57FC94FDF35501B96C6BDAA20D3303DB4B59C24765187AE012B9F3EEE5DCB43FD09FF6EDD2539F0D0C044DCFF2186DE940BA787FC3615A97D35FDCC04E61A5CDEB280FF5F0CCB4A1A61AD460BF3AC55D16A56261EFB85F6ADB539D5F1DF70FFB430D3B5ED461F877E429B73075A0872290281807829835784AB2069BD7A9B4B4CD436E266FBEC4D8CE2ECBEBCA7711D9DF873606551C9688F0FBF2CD6F580F306243120F3E87B9B8ED452E020EEBBB9A802F1F654944C0170D827D5E55ED55C4C818A4F1A5CBE80B48DAE9DF6BCF88A04AD23FE55C3915CE7F13B67A9FA97054B72C406F6FE4AC33569001618EBEB953047AB810281801A6C42DB94ADF9D4895BD8B35FB8345C5930985DBF39D8D2469D2F8227EE368A762652EF9F17CCC765BC6ADDB9CDF2CA1568420346822884873E2DA7A4362ED1381B847258712134F0E9F13143FF4CB9D92C8A972C525E56317B75859E524B59C32024580743F060CCA2CB241EB6CB0BC0D11493F2A3458E900E0E8BC742E90F
```

You can take that whole octet string, hex decode it back into binary, and re-parse it. Just remember that it's bianry now and thus in DER format.

```bash
echo -n "3...F" | xxd -r -p | openssl asn1parse -inform DER
```

---

Here's the whole command

```
bash
echo -n "308204A2020100028201010091F30417B4DC5AFEAEBD246FA6CC576B2916FB183E23F2508102AB5EBABBBE450C17A1EA5AF1073F906DF049EE56923092D17EE4D2EE74F048C889BA59B308E962409FCDDB3A61506D03E1B5C8CCA7552DFB4BFCC31E67C8DF8FF580FF44C5C8EDCC35CFFD24C2FDF379497E9796EADA882CB0F329D735364C9B237B223272AE1A24E0F3107015CB9142BFD7B140EB0F5BD7D68B18CC0EA902FEDD17868D550C0A0B12B5771D85CFAE2113E1635B9D04AF0385D5B8F39D47F3142387099427E3836BB9B310FD1FD36E0C5592281604B66D2B8A9B42F2708065F32580927ACE6374D823FE7FB9FA8E1C50307F740A004AA72585B35E7F6EE7A6C9E1FEC67BE92D0203010001028201001D15DD806DF2260E303B9059D1D7522A90673C8601C83F1F8CFE3FB1A2AC0C888D16DE952A277386D6DD19F059D795CDA94CA7A9A9618D1B5F9DDB58B04C8E1F988D816B505FAB8A1017A0710E41BEAD2A7B3492FC3D8078571944D73EC7F15490134CBC14DA3123D3D41D71E57AD575D4827787161505CD3AEA05E1A1988522E0F00EB9A6675C7861E066F5D519728ED2E2C2AC53B44469D6D941219CED23E05D2FCF32E861EC3911D0AE213F03F2F26E09E277E5D02D00F6DF93A80A45E1D99FB51A5A2FD807BFCF07BCD01638FD6BFB77743CFDAF4D0850479D5CBDFFA20F9C73EFA854EE7863993D821C5B5E197952BA7BAFE8C0962A8BDC89FEE01A9AE102818100CDD584B18A8938A0D1066150E13DBC528F16D1A482653E2F60DA4F1AD3901992A12F078D4C4EF591C1C770B434BC74E9418DD0803A1F6125FB8EC6BDF455FB33F93EE2CBDEF8D8D903E4801A2C4166B4D362A01C3825807CB73882A226D94EBFE39E1F7942844B302B764DE6161751222634C045AAAB21873DD9C2DFA0222BDD02818100B585247F207244F331D40E325EB16C60AA7FDAAB214884C108F55D8BAD9D103E7545FFDF49ED4BBEFC61022CB2F46207DDB0806CD33352C76C0C7158402E3A062CE8A2E54F50EA6A4ACD815D262D5BB9C8D6A700410A73891255584517F9D1E660986C93CF8E28760C314A10EA18BBA7CA06E70965240D060C61458A9EE0C5910281803C8599BCB26562B7367ECFC27E582EB57FC94FDF35501B96C6BDAA20D3303DB4B59C24765187AE012B9F3EEE5DCB43FD09FF6EDD2539F0D0C044DCFF2186DE940BA787FC3615A97D35FDCC04E61A5CDEB280FF5F0CCB4A1A61AD460BF3AC55D16A56261EFB85F6ADB539D5F1DF70FFB430D3B5ED461F877E429B73075A0872290281807829835784AB2069BD7A9B4B4CD436E266FBEC4D8CE2ECBEBCA7711D9DF873606551C9688F0FBF2CD6F580F306243120F3E87B9B8ED452E020EEBBB9A802F1F654944C0170D827D5E55ED55C4C818A4F1A5CBE80B48DAE9DF6BCF88A04AD23FE55C3915CE7F13B67A9FA97054B72C406F6FE4AC33569001618EBEB953047AB810281801A6C42DB94ADF9D4895BD8B35FB8345C5930985DBF39D8D2469D2F8227EE368A762652EF9F17CCC765BC6ADDB9CDF2CA1568420346822884873E2DA7A4362ED1381B847258712134F0E9F13143FF4CB9D92C8A972C525E56317B75859E524B59C32024580743F060CCA2CB241EB6CB0BC0D11493F2A3458E900E0E8BC742E90F" | xxd -r -p | openssl asn1parse -inform DER
```

...and you'll find that it's the original PKCS#1 key format.
